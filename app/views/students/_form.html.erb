<div>
  <%= form.label "First name" %>
  <%= form.text_field :first_name %>
</div>
<div>
  <%= form.label "Surname" %>
  <%= form.text_field :last_name %>
</div>
<div>
  <%= form.label "Prison number" %>
  <%= form.text_field :prison_number %>
</div>
<div>
  <%= form.label "Site" %>
   <%= form.collection_select :site_id, Site.order(:name),:id,:name, include_blank: true, selected: (@student&.site.present? ? @student.site.id : params[:site]) %>
</div>
<div>
  <%= form.label "Gender" %>
  <%= form.select :gender, ["Male","Female"] %>
</div>
<div>
  <%= form.label "Date of birth" %>
  <%= form.date_field :dob %>
</div>
<h4>Key dates:</h4>
<div>
  <%= form.label "Release date" %>
  <%= form.date_field :crd %>
</div>
<div>
  <%= form.label "Eligible for tag" %>
  <%= form.date_field :hdc %>
</div>
<div>
  <%= form.label "Eligible for ROTL" %>
  <%= form.date_field :rotl %>
</div>
<div>
  <%= form.label "Next recategorisation" %>
  <%= form.date_field :recat %>
</div>
<div>
  <%= form.label "Skills" %>
  <%= form.text_field :skill_list %>
  <%= form.select("skills", Student.tag_counts_on(:skills).collect{ |t| [ t.name, t.name ] }, { selected: @student.skill_list }, { id: "skill_tags_#{@student.id}", class: 'tag_list',  multiple: true, :onchange=>"addSkillTags(#{@student.id});" }) %>
</div>
<div>
  <%= form.label "Job preferences" %>
  <%= form.text_field :job_preference_list %>
</div>
<div>
  <%= form.label "Tags" %>
  <%= form.text_field :tag_list %>
</div>
<div>
  <%= form.label "Notes" %><br>
  <%= form.text_area :notes %>
</div>
<div>
  <%= form.submit "Save" %>
</div>

<% content_for :head do %>
  <script>
    $(document).on('ready page:load', function () {
      var select, chosen;
      select = $('.tag_list');
      select.chosen({
        allow_single_deselect: true,
        width: '200px',
        placeholder_text_multiple: 'Add tags',
        no_results_text: 'Press enter to add:'
      });

      chosen = $('.chosen-container');
      chosen.find('input').keyup( function(e) {
          if (e.which === 13 && chosen.find('li.no-results').length > 0){
              var option = $("<option>").val(this.value).text(this.value);
              select.prepend(option);
              select.find(option).prop('selected', true);
              select.trigger("chosen:updated");
          }
      });
    });

    function addSkillTags(id) {
      var data = $('#skill_tags_' + id).val();
      $.ajax({
        type: "POST",
        url: "/students/add_skills",
        dataType: "json",
        data: { id: id, tags: data }
      });
    }
    }
  </script>
<% end %>
